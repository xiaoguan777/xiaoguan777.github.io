<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>JDBC演示（一）</title>
    <url>/JDBC/jdbc%E6%BC%94%E7%A4%BA%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    <content><![CDATA[<h3 id="JDBC经典代码"><a href="#JDBC经典代码" class="headerlink" title="JDBC经典代码"></a>JDBC经典代码</h3><span id="more"></span>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Driver;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//&quot;C:\Users\xiaoguan\Downloads\test\com\mysql\jdbc\Driver.class&quot;</span></span><br><span class="line">		Statement stm=<span class="literal">null</span>;</span><br><span class="line">		Connection conn=<span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="comment">//1.注册驱动</span></span><br><span class="line">			<span class="type">Driver</span> <span class="variable">driver</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">com</span>.mysql.cj.jdbc.Driver();</span><br><span class="line">			DriverManager.registerDriver(driver);</span><br><span class="line">			<span class="comment">//2.获取连接</span></span><br><span class="line">			String name=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">             <span class="comment">//URL=通信协议+ip+端口+内容</span></span><br><span class="line">			String url=<span class="string">&quot;jdbc:mysql://10.198.179.163:3306/bjpowernode&quot;</span>;</span><br><span class="line">			String pw=<span class="string">&quot;68963120g&quot;</span>;</span><br><span class="line">			conn=DriverManager.getConnection(url,name,pw);</span><br><span class="line">			System.out.println(<span class="string">&quot;数据库为&quot;</span>+conn);</span><br><span class="line">			<span class="comment">//3.获取数据库对象(专门执行sql语句）</span></span><br><span class="line">		    stm=conn.createStatement();</span><br><span class="line">			String sql=<span class="string">&quot;update dept set dname=&#x27;xdu&#x27;,loc=&#x27;西安&#x27; where deptno=50&quot;</span>;<span class="comment">//不用在最后加分号</span></span><br><span class="line">			<span class="comment">//4.执行sql</span></span><br><span class="line">			<span class="comment">//专门执行DML语句</span></span><br><span class="line">			<span class="comment">//返回值影响数据库中的记录条数</span></span><br><span class="line">			<span class="type">int</span> count=stm.executeUpdate(sql);</span><br><span class="line">			System.out.println(<span class="string">&quot;count为&quot;</span>+count);</span><br><span class="line">			</span><br><span class="line">		&#125;<span class="keyword">catch</span>(SQLException e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//6.释放资源</span></span><br><span class="line">			<span class="comment">//重小到大释放，statement----&gt;connection</span></span><br><span class="line">			<span class="keyword">try</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(stm!=<span class="literal">null</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					stm.close();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span>(SQLException e)</span><br><span class="line">			&#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">try</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					conn.close();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span>(SQLException e)</span><br><span class="line">			&#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//5.处理查询结果集这里没有演示</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>计算机学习</category>
        <category>Java</category>
        <category>JDBC</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Mysql</tag>
        <tag>JDBC</tag>
      </tags>
  </entry>
  <entry>
    <title>JDBC演示（二）</title>
    <url>/JDBC/jdbc%E6%BC%94%E7%A4%BA%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    <content><![CDATA[<h3 id="JDBC经典代码"><a href="#JDBC经典代码" class="headerlink" title="JDBC经典代码"></a>JDBC经典代码</h3><span id="more"></span>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test3</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//&quot;C:\Users\xiaoguan\Downloads\test\com\mysql\jdbc\Driver.class&quot;</span></span><br><span class="line">		ResourceBundle bundle=ResourceBundle.getBundle(<span class="string">&quot;JDBC&quot;</span>);</span><br><span class="line">		Statement stm=<span class="literal">null</span>;</span><br><span class="line">		Connection conn=<span class="literal">null</span>;</span><br><span class="line">		ResultSet rs=<span class="literal">null</span>;<span class="comment">//关闭顺序rs--&gt;stm--&gt;conn</span></span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="comment">//1.注册驱动</span></span><br><span class="line">			<span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span>bundle.getString(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">			Class.forName(driver);</span><br><span class="line">			<span class="comment">//2.获取连接</span></span><br><span class="line">			String name=bundle.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">			String url=bundle.getString(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">			String pw=bundle.getString(<span class="string">&quot;pw&quot;</span>);</span><br><span class="line">			conn=DriverManager.getConnection(url,name,pw);</span><br><span class="line">			System.out.println(<span class="string">&quot;数据库为&quot;</span>+conn);</span><br><span class="line">			<span class="comment">//3.获取数据库对象(专门执行sql语句）</span></span><br><span class="line">		    stm=conn.createStatement();</span><br><span class="line">			<span class="comment">//4.执行sql</span></span><br><span class="line">			<span class="comment">//专门执行DQL语句</span></span><br><span class="line">			<span class="comment">//返回值影响数据库中的记录条数</span></span><br><span class="line">			String sql=<span class="string">&quot;select * from dept&quot;</span>;<span class="comment">//不用在最后加分号</span></span><br><span class="line">			rs=stm.executeQuery(sql);</span><br><span class="line">			<span class="comment">//5.处理查询结果集(JDBC中下标列从1开始）</span></span><br><span class="line">			<span class="keyword">while</span>(rs.next())</span><br><span class="line">			&#123;</span><br><span class="line">				String deptno=rs.getString(<span class="number">1</span>);<span class="comment">//数字建议换成字符串的列名，更健壮，换列了也能输出，列明为最终查询结果重命名后的名字,要int类型就getInt，以此类推，可以用来运算。</span></span><br><span class="line">				String dname=rs.getString(<span class="number">2</span>);</span><br><span class="line">				String loc=rs.getString(<span class="number">3</span>);</span><br><span class="line">				System.out.println(deptno+<span class="string">&quot;,&quot;</span>+dname+<span class="string">&quot;,&quot;</span>+loc);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">		&#125;<span class="keyword">catch</span>(SQLException e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(ClassNotFoundException e)&#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">finally</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//6.释放资源</span></span><br><span class="line">			<span class="comment">//重小到大释放，ResultSet----&gt;statement----&gt;connection</span></span><br><span class="line">			<span class="keyword">try</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(rs!=<span class="literal">null</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					rs.close();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span>(SQLException e)</span><br><span class="line">			&#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">try</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(stm!=<span class="literal">null</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					stm.close();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span>(SQLException e)</span><br><span class="line">			&#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">try</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					conn.close();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span>(SQLException e)</span><br><span class="line">			&#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>properties文件</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">写驱动</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">写用户名</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">数据库url</span></span><br><span class="line"><span class="attr">pw</span>=<span class="string">写密码</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>计算机学习</category>
        <category>Java</category>
        <category>JDBC</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Mysql</tag>
        <tag>JDBC</tag>
      </tags>
  </entry>
  <entry>
    <title>JDBC演示（三）</title>
    <url>/JDBC/jdbc%E6%BC%94%E7%A4%BA%EF%BC%88%E4%B8%89%EF%BC%89/</url>
    <content><![CDATA[<h3 id="单一数据库事务代码演示"><a href="#单一数据库事务代码演示" class="headerlink" title="单一数据库事务代码演示"></a>单一数据库事务代码演示</h3><span id="more"></span>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> os;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.ResourceBundle;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="comment">//PreparedStatement的原理是预先对SQL语句的框架进行编译，然后再给SQL语句传值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCtest</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//初始化UI</span></span><br><span class="line">        Map&lt;String,String&gt; userLoginInfo=initUI();</span><br><span class="line">        <span class="comment">//验证用户名和密码</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">loginSuccess</span> <span class="operator">=</span> login(userLoginInfo);</span><br><span class="line">        System.out.println(loginSuccess?<span class="string">&quot;登录成功&quot;</span>:<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">login</span><span class="params">(Map&lt;String,String&gt; data)</span></span><br><span class="line">    &#123;</span><br><span class="line">        ResourceBundle bundle=ResourceBundle.getBundle(<span class="string">&quot;JDBC&quot;</span>);</span><br><span class="line">        Connection conn=<span class="literal">null</span>;</span><br><span class="line">        PreparedStatement stm=<span class="literal">null</span>;</span><br><span class="line">        ResultSet rt=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(bundle.getString(<span class="string">&quot;driver&quot;</span>));</span><br><span class="line">            String url=bundle.getString(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">            String name=bundle.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            String pw=bundle.getString(<span class="string">&quot;pw&quot;</span>);</span><br><span class="line">            conn= DriverManager.getConnection(url,name,pw);</span><br><span class="line">            conn.setAutoCommit(<span class="literal">false</span>);<span class="comment">//开启事务</span></span><br><span class="line">            String sql1=<span class="string">&quot;Update t_logintest set 登录名 = ? where id=?&quot;</span>;</span><br><span class="line">            stm=conn.prepareStatement(sql1);</span><br><span class="line">            stm.setString(<span class="number">1</span>,<span class="string">&quot;王五&quot;</span>);</span><br><span class="line">            stm.setInt(<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line">            <span class="type">int</span> count=stm.executeUpdate();</span><br><span class="line">            <span class="comment">//String s=null;</span></span><br><span class="line">            <span class="comment">//s.toString();</span></span><br><span class="line">            System.out.println(count);</span><br><span class="line">            stm.setString(<span class="number">1</span>,<span class="string">&quot;Kangkang&quot;</span>);</span><br><span class="line">            stm.setInt(<span class="number">2</span>,<span class="number">2</span>);</span><br><span class="line">            count=stm.executeUpdate();</span><br><span class="line">            System.out.println(count);</span><br><span class="line">            conn.commit();<span class="comment">//提交事务</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.rollback();<span class="comment">//回滚事务</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(rt!=<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    rt.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(stm!=<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    stm.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化用户界面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>返回用户名和密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; <span class="title function_">initUI</span><span class="params">()</span> &#123;</span><br><span class="line">        Scanner sc=<span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入用户名：&quot;</span>);</span><br><span class="line">        String userName=sc.nextLine();</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入密码：&quot;</span>);</span><br><span class="line">        String pw=sc.nextLine();</span><br><span class="line">        Map&lt;String,String&gt; userLoginInfo= <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        userLoginInfo.put(<span class="string">&quot;用户名&quot;</span>,userName);</span><br><span class="line">        userLoginInfo.put(<span class="string">&quot;密码&quot;</span>,pw);</span><br><span class="line">        <span class="keyword">return</span>  userLoginInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//PrepareedStatement（传值时会做检查） 执行效率高,编译一次执行n次,Statement 编译一次执行一次</span></span><br></pre></td></tr></table></figure>

<h3 id="行级锁"><a href="#行级锁" class="headerlink" title="行级锁"></a>行级锁</h3><p>在sql查询语句后面加for update,把这一行的数据锁住不能动，又叫悲观锁（开启事务后才锁）。</p>
<p>悲观锁:事务必须排队执行，数据锁住了不允许并发</p>
<p>乐观锁：支持并发，事务也不需要排队，只不过需要一个版本号</p>
]]></content>
      <categories>
        <category>计算机学习</category>
        <category>Java</category>
        <category>JDBC</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Mysql</tag>
        <tag>JDBC</tag>
      </tags>
  </entry>
  <entry>
    <title>登录sql注入问题</title>
    <url>/JDBC/%E7%99%BB%E5%BD%95sql%E6%B3%A8%E5%85%A5%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h3 id="会被sql注入的代码"><a href="#会被sql注入的代码" class="headerlink" title="会被sql注入的代码"></a>会被sql注入的代码</h3><p>当密码有类似<code>fdsa&#39; or &#39;1&#39;=&#39;1</code>,会被sql注入，原因是字符串拼接时1&#x3D;1这种类似条件会执行在sql语句中，这时就会被sql注入密码输错也能登录成功，要避免此问题不能用Statement,要用PreparedStatement。PreparedStatement会预编译，然后确定值得正确性才执行sql语句。</p>
<span id="more"></span>

<p>不安全代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> os;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.ResourceBundle;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">login</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//初始化UI</span></span><br><span class="line">        Map&lt;String,String&gt; userLoginInfo=initUI();</span><br><span class="line">        <span class="comment">//验证用户名和密码</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">loginSuccess</span> <span class="operator">=</span> login(userLoginInfo);</span><br><span class="line">        System.out.println(loginSuccess?<span class="string">&quot;登录成功&quot;</span>:<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">login</span><span class="params">(Map&lt;String,String&gt; data)</span></span><br><span class="line">    &#123;</span><br><span class="line">        ResourceBundle bundle=ResourceBundle.getBundle(<span class="string">&quot;JDBC&quot;</span>);</span><br><span class="line">        Connection conn=<span class="literal">null</span>;</span><br><span class="line">        Statement stm=<span class="literal">null</span>;</span><br><span class="line">        ResultSet rt=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(bundle.getString(<span class="string">&quot;driver&quot;</span>));</span><br><span class="line">            String url=bundle.getString(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">            String name=bundle.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            String pw=bundle.getString(<span class="string">&quot;pw&quot;</span>);</span><br><span class="line">            conn= DriverManager.getConnection(url,name,pw);</span><br><span class="line">            stm=conn.createStatement();</span><br><span class="line">            String sql=<span class="string">&quot;select * from t_logintest where 登录名=&#x27;&quot;</span>+data.get(<span class="string">&quot;用户名&quot;</span>)+<span class="string">&quot;&#x27; and 登录密码=&#x27;&quot;</span>+data.get(<span class="string">&quot;密码&quot;</span>)+<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            rt=stm.executeQuery(sql);</span><br><span class="line">            <span class="keyword">if</span>(rt.next())</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">return</span>  <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(rt!=<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    rt.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(stm!=<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    stm.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化用户界面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>返回用户名和密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; <span class="title function_">initUI</span><span class="params">()</span> &#123;</span><br><span class="line">        Scanner sc=<span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入用户名：&quot;</span>);</span><br><span class="line">        String userName=sc.nextLine();</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入密码：&quot;</span>);</span><br><span class="line">        String pw=sc.nextLine();</span><br><span class="line">        Map&lt;String,String&gt; userLoginInfo= <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        userLoginInfo.put(<span class="string">&quot;用户名&quot;</span>,userName);</span><br><span class="line">        userLoginInfo.put(<span class="string">&quot;密码&quot;</span>,pw);</span><br><span class="line">        <span class="keyword">return</span>  userLoginInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="不会被sql注入的代码"><a href="#不会被sql注入的代码" class="headerlink" title="不会被sql注入的代码"></a>不会被sql注入的代码</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> os;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.ResourceBundle;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="comment">//PreparedStatement的原理是预先对SQL语句的框架进行编译，然后再给SQL语句传值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">loginplus</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//初始化UI</span></span><br><span class="line">        Map&lt;String,String&gt; userLoginInfo=initUI();</span><br><span class="line">        <span class="comment">//验证用户名和密码</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">loginSuccess</span> <span class="operator">=</span> login(userLoginInfo);</span><br><span class="line">        System.out.println(loginSuccess?<span class="string">&quot;登录成功&quot;</span>:<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">login</span><span class="params">(Map&lt;String,String&gt; data)</span></span><br><span class="line">    &#123;</span><br><span class="line">        ResourceBundle bundle=ResourceBundle.getBundle(<span class="string">&quot;JDBC&quot;</span>);</span><br><span class="line">        Connection conn=<span class="literal">null</span>;</span><br><span class="line">        PreparedStatement stm=<span class="literal">null</span>;</span><br><span class="line">        ResultSet rt=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(bundle.getString(<span class="string">&quot;driver&quot;</span>));</span><br><span class="line">            String url=bundle.getString(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">            String name=bundle.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            String pw=bundle.getString(<span class="string">&quot;pw&quot;</span>);</span><br><span class="line">            conn= DriverManager.getConnection(url,name,pw);</span><br><span class="line">            String sql=<span class="string">&quot;select * from t_logintest where 登录名=? and 登录密码=?&quot;</span>;<span class="comment">//sql语句框子，一个问号表示一个占位符一个问号表示接收一个值，没有单引号</span></span><br><span class="line">            stm=conn.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//给问号传值，第一个问号小标为1,第二个问号下标为2...</span></span><br><span class="line">            stm.setString(<span class="number">1</span>,data.get(<span class="string">&quot;用户名&quot;</span>));</span><br><span class="line">            stm.setString(<span class="number">2</span>,data.get(<span class="string">&quot;密码&quot;</span>));</span><br><span class="line">            rt=stm.executeQuery();</span><br><span class="line">            <span class="keyword">if</span>(rt.next())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>  <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(rt!=<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    rt.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(stm!=<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    stm.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(conn!=<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化用户界面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>返回用户名和密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; <span class="title function_">initUI</span><span class="params">()</span> &#123;</span><br><span class="line">        Scanner sc=<span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入用户名：&quot;</span>);</span><br><span class="line">        String userName=sc.nextLine();</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入密码：&quot;</span>);</span><br><span class="line">        String pw=sc.nextLine();</span><br><span class="line">        Map&lt;String,String&gt; userLoginInfo= <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        userLoginInfo.put(<span class="string">&quot;用户名&quot;</span>,userName);</span><br><span class="line">        userLoginInfo.put(<span class="string">&quot;密码&quot;</span>,pw);</span><br><span class="line">        <span class="keyword">return</span>  userLoginInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//PrepareedStatement（传值时会做检查） 执行效率高,编译一次执行n次,Statement 编译一次执行一次</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="附录properties文件"><a href="#附录properties文件" class="headerlink" title="附录properties文件"></a>附录properties文件</h3><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">写驱动</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">写用户名</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">数据库url</span></span><br><span class="line"><span class="attr">pw</span>=<span class="string">写密码</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>计算机学习</category>
        <category>Java</category>
        <category>JDBC</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Mysql</tag>
        <tag>JDBC</tag>
      </tags>
  </entry>
</search>
